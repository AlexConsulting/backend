<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üõ° SOC Threat Scanner</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#0f1724; --panel:#111827; --muted:#9aa4b2; --accent:#00aaff; --danger:#e74c3c; --warn:#f39c12; --ok:#2ecc71;
      --glass: rgba(255,255,255,0.03);
      --card-shadow: 0 6px 18px rgba(2,6,23,0.6);
      --border: rgba(255,255,255,0.04);
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #dbe6f3;
      background: linear-gradient(180deg, #081023 0%, #061024 100%);
    }
    html,body{height:100%; margin:0; padding:0;}
    a{color:var(--accent); text-decoration:none}
    .container{max-width:1200px; margin:20px auto; padding:20px;}
    header.topbar{display:flex; align-items:center; gap:16px; margin-bottom:18px;}
    .brand{display:flex; align-items:center; gap:12px}
    .brand .shield{width:48px; height:48px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#08283a,#00334d); border-radius:10px; box-shadow:0 6px 14px rgba(0,0,0,0.6);}
    .brand h1{font-size:18px; margin:0; letter-spacing:0.2px}
    .brand p{margin:0; font-size:12px; color:var(--muted)}
    .controls{margin-left:auto; display:flex; gap:8px; align-items:center}
    .btn{background:var(--glass); border:1px solid var(--border); padding:8px 12px; border-radius:8px; cursor:pointer; color:var(--accent)}
    .btn.secondary{background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.02)}
    .grid{display:grid; grid-template-columns: 1fr 380px; gap:18px;}

    .left-col{display:flex; flex-direction:column; gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:14px; box-shadow:var(--card-shadow); border:1px solid var(--border);}
    .card.small{padding:10px}
    .card .title{font-size:13px; color:var(--muted); margin-bottom:8px}

    .scan-row{display:flex; gap:8px; align-items:center}
    input[type="text"]{flex:1; padding:10px 12px; background:transparent; border:1px solid var(--border); border-radius:8px; color:inherit}
    select{padding:8px 10px; border-radius:8px; background:transparent; border:1px solid var(--border); color:inherit}
    #btnAnalyze{background:linear-gradient(90deg,var(--accent),#0088cc); color:#041226; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600}

    .score-card{display:flex; gap:12px; align-items:center}
    .score-left{width:120px; height:120px; display:flex; align-items:center; justify-content:center; position:relative}
    #scoreChart{width:120px; height:120px}
    .score-right{flex:1}
    .score-value{font-size:28px; font-weight:700}
    .classification-display{display:inline-block; padding:6px 8px; border-radius:8px; font-weight:600; margin-top:8px}
    .high-risk{background:rgba(231,76,60,0.12); color:var(--danger); border:1px solid rgba(231,76,60,0.14)}
    .medium-risk{background:rgba(243,156,18,0.08); color:var(--warn); border:1px solid rgba(243,156,18,0.10)}
    .low-risk{background:rgba(46,204,113,0.06); color:var(--ok); border:1px solid rgba(46,204,113,0.06)}

    .tools-list{display:flex; gap:8px; flex-wrap:wrap}
    .tool-pill{padding:8px 10px; border-radius:999px; background:rgba(255,255,255,0.02); border:1px solid var(--border); display:flex; gap:8px; align-items:center; font-size:13px}
    .tool-pill .dot{width:9px;height:9px;border-radius:50%}
    .dot.ok{background:var(--ok)} .dot.warn{background:var(--warn)} .dot.err{background:var(--danger)} .dot.empty{background:#6b7280}

    .right-col{display:flex; flex-direction:column; gap:14px}
    .technical {display:flex; flex-direction:column; gap:8px}
    .technical pre{background:rgba(0,0,0,0.12); padding:8px; border-radius:8px; color:#cbd5e1; overflow:auto; max-height:260px}

    .row{display:flex; gap:12px}
    .col{flex:1}

    .modal{display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; overflow:auto; background:rgba(2,6,23,0.6); align-items:center; justify-content:center}
    .modal .modal-content{background:#071025; padding:18px; border-radius:12px; width:86%; max-width:1000px; border:1px solid var(--border)}
    .modal .tabs{display:flex; gap:8px; margin-bottom:10px}
    .tab{padding:8px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.02); cursor:pointer}
    .tab.active{background:linear-gradient(90deg,#042233,#083447); color:var(--accent); border:1px solid rgba(0,170,255,0.12)}

    footer{margin-top:18px; color:var(--muted); font-size:12px; text-align:center}
    @media (max-width:1024px){ .grid{grid-template-columns:1fr} .right-col{order:2} }
	
	/* Oculta conte√∫do RAW e protege contra sobrescrita visual */
	#modalRaw,
	[data-panel="raw"],
	.tab[data-tab="raw"] {
	display: none !important;
	visibility: hidden !important;
	height: 0 !important;
	overflow: hidden !important;
	padding: 0 !important;
	margin: 0 !important;
}

/* ---------------------------
   Ajustes VISUAIS solicitados
   - cards verticais no right-col
   - RAW JSON card com collapse
   --------------------------- */

.right-col .card { /* refor√ßa estilo de card para a coluna direita */
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: var(--radius);
  padding: 14px;
  box-shadow: var(--card-shadow);
  border: 1px solid var(--border);
}

/* RAW preview - limitar altura e animar */
#evidence pre {
  white-space: pre-wrap;
  color: #b6c8da;
  margin: 0;
  max-height: 120px;
  overflow: hidden;
  transition: max-height .3s ease;
}

/* bot√£o do RAW */
#btnToggleRaw {
  margin-top: 10px;
  background: transparent;
  border: 1px solid rgba(255,255,255,0.03);
  color: var(--accent);
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
}

/* estilo dos novos cards (t√≠tulos mais vis√≠veis) */
.right-col .card .title {
  color: var(--muted);
  font-weight: 700;
  margin-bottom: 8px;
}

/* layout interno dos 3 cards t√©cnicos (cada card empilhado) */
#technicalSummaryCard, #abuseCard, #geoCard {
  margin-bottom: 10px;
}

/* pequenas melhorias responsivas */
@media (max-width:700px){
  #evidence pre { max-height: 200px; }
}

/* ===== MOBILE GLASS NAVIGATION ===== */
.mobile-nav-glass {
  display: none;
}

@media (max-width: 768px) {

  /* espa√ßo para nav inferior */
  body {
    padding-bottom: 90px !important;
    overflow-y: auto !important;
  }

  /* reorganiza o container principal */
  .grid {
    grid-template-columns: 1fr !important;
  }

  .right-col {
    order: 2 !important;
  }

  .left-col {
    order: 1 !important;
  }

  /* Barra inferior */
  .mobile-nav-glass {
    display: flex;
    position: fixed;
    bottom: 14px;
    left: 12px;
    right: 12px;
    height: 60px;
    justify-content: space-around;
    align-items: center;
    padding: 6px 14px;
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(14px);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 10px 35px rgba(0,0,0,0.35);
    z-index: 9999;
  }

  .mobile-nav-glass button {
    background: none;
    border: none;
    color: #dbe6f3;
    font-size: 26px;
    cursor: pointer;
    transition: 0.15s;
  }

  .mobile-nav-glass button:hover {
    transform: translateY(-4px);
    color: #4da3ff;
  }
}

/* ===== SHIELD LOGO ===== */

/* Escudo b√°sico */
.shield {
  position: relative;
  width: 60px; /* Tamanho do escudo aumentado */
  height: 60px; /* Tamanho do escudo aumentado */
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #08283a, #00334d); /* Gradiente mantendo as cores */
  border-radius: 50%; /* Escudo arredondado */
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.6); /* Sombra para destacar */
  transition: all 0.3s ease-in-out;
  overflow: hidden; /* Garante que os efeitos n√£o saiam do escudo */
}

/* Linhas de dados animadas dentro do escudo */
.shield .data-lines {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 10%, rgba(255, 255, 255, 0) 70%);
  opacity: 0.5; /* Opacidade suave para o efeito */
  pointer-events: none; /* Impede intera√ß√£o */
  animation: dataFlow 3s infinite ease-in-out; /* Anima√ß√£o suave das linhas de IA */
}

/* Anima√ß√£o das Linhas de Dados (representando IA e an√°lise de dados) */
@keyframes dataFlow {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.3;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.05);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.3;
  }
}

/* Efeito de IA no centro (ponto pulsante central) */
.shield::before {
  content: '';
  position: absolute;
  width: 12px; /* Tamanho pequeno para n√£o interferir no escudo */
  height: 12px; /* Tamanho pequeno para n√£o interferir no escudo */
  border-radius: 50%;
  background-color: #fff; /* Cor do ponto de IA */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); /* Efeito de brilho sutil */
  animation: pulse 2s infinite ease-in-out; /* Efeito de pulsa√ß√£o suave */
}

/* Anima√ß√£o de pulsa√ß√£o para IA (efeito do ponto central) */
@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 0.7;
  }
  50% {
    transform: scale(1.3);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 0.7;
  }
}

.shield:hover {
  /* Adiciona um brilho ciano/neon ao redor do escudo */
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 6px 14px rgba(0, 0, 0, 0.8); 
  /* Leve zoom para destacar o componente */
  transform: scale(1.1); 
}
.shield:hover svg path {
  /* Altera a cor do preenchimento do √≠cone SVG para um ciano mais claro */
  fill: #00FFFF; 
}
/* ================================================= */
/* 1. EFEITO DE VARREDURA NO T√çTULO (.scanner-title) */
/* (Velocidade R√ÅPIDA: 0.5s)                         */
/* ================================================= */

/* Container do T√≠tulo (Importante para o posicionamento relativo) */
.scanner-title {
  position: relative;
  display: inline-block; /* Garante que a largura se ajuste ao texto */
  overflow: hidden; /* CRUCIAL: Esconde o pseudo-elemento antes e depois da varredura */
}

/* Pseudo-elemento que far√° a linha de varredura */
.scanner-title::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%; /* Come√ßa totalmente fora da tela (√† esquerda) */
  width: 100%;
  height: 100%;
  pointer-events: none; /* N√£o interfere na sele√ß√£o do texto */
  
  /* CRIA√á√ÉO DO EFEITO DE BRILHO (GRADIENTE) */
  background: linear-gradient(
    90deg, 
    transparent 0%, /* In√≠cio transparente */
    rgba(0, 255, 255, 0.4) 50%, /* Meio: Brilho Ciano Neon (voc√™ pode usar #fff) */
    transparent 100% /* Fim transparente */
  );
  
  transition: none; /* Desativa a transi√ß√£o para que a anima√ß√£o seja r√°pida e resete */
}

/* Anima√ß√£o no Hover: Move a linha de varredura da esquerda para a direita */
.scanner-title:hover::before {
  /* Move o brilho de -100% (in√≠cio) para 100% (fim) */
  left: 100%; 
  /* Dura√ß√£o r√°pida (0.5s) para simular um scanner */
  transition: left 1.2s ease-in-out; 
}

/* =============================== */
/*      MOBILE PREMIUM LAYOUT      */
/* =============================== */

@media (max-width: 768px) {

  /* ---- AJUSTE GERAL ---- */
  .container {
    padding: 10px !important;
  }

  header.topbar {
    flex-direction: column;
    gap: 6px;
    text-align: center;
  }

  .brand h1 {
    font-size: 18px !important;
  }
  .brand p {
    font-size: 11px !important;
  }

  /* ---- GRID vira layout linear ---- */
  .grid {
    display: flex !important;
    flex-direction: column !important;
    gap: 14px !important;
  }

  /* ---- SCORE CARD adaptado ---- */
  .score-card {
    flex-direction: column;
    text-align: center;
  }
  .score-left {
    width: 90px !important;
    height: 90px !important;
  }
  #scoreChart {
    width: 90px !important;
    height: 90px !important;
  }
  .score-value {
    font-size: 22px !important;
  }

  /* ---- BOT√ïES MAIS US√ÅVEIS NO MOBILE ---- */
  #btnAnalyze, .btn, .btn.secondary {
    padding: 10px 14px;
    font-size: 15px !important;
  }

  /* ---- CARDS OTIMIZADOS ---- */
  .card {
    padding: 12px !important;
  }
  .card .title {
    font-size: 14px !important;
    font-weight: 600;
  }

  /* ---- TRANSFORMA IA / RESUMO EM CARDS COLAPS√ÅVEIS ---- */
  .collapsible-card {
    max-height: 80px;
    overflow: hidden;
    position: relative;
    transition: max-height 0.35s ease;
  }

  .collapsible-card.expanded {
    max-height: 600px;
  }

  /* fade bonito */
  .collapsible-card::after {
    content: "";
    position: absolute;
    left: 0; right: 0; bottom: 0;
    height: 40px;
    background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.4));
    pointer-events: none;
  }

  .collapsible-card.expanded::after {
    display: none;
  }

  .expand-btn {
    margin-top: 8px;
    background: rgba(255,255,255,0.05);
    width: 100%;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 6px;
    color: #4da3ff;
    font-size: 14px;
    cursor: pointer;
    text-align: center;
  }

  /* ---- AJUSTE DO RAW ---- */
  #evidence pre {
    max-height: 200px !important;
  }

  /* ---- MENOR ESPA√áAMENTO NO RODAP√â ---- */
  footer {
    margin-bottom: 80px;
  }
}

  </style>

<style>
/* Loading overlay additions */
#loadingOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 99999;
}
.loader {
  width: 55px;
  height: 55px;
  border: 6px solid #66aaff;
  border-bottom-color: transparent;
  border-radius: 50%;
  animation: rotation 1s linear infinite;
}
@keyframes rotation {
  from { transform: rotate(0); }
  to { transform: rotate(360deg); }
}
.loading-title { margin-top: 10px; font-size: 20px; }
.progress-bar-container {
  width: 260px; height: 18px; background: #222;
  border-radius: 10px; overflow: hidden; border: 1px solid #555; margin-top: 10px;
}
.progress-bar {
  width: 0%; height: 100%; background: linear-gradient(90deg,#007bff,#66aaff);
  transition: width 0.4s ease;
}
.loading-steps { margin-top: 10px; font-size: 16px; opacity: 0.85; }

</style>
</head>

<body>
  <div class="container">

    <header class="topbar">
      <div class="brand">
        <div class="shield" aria-hidden>
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M12 2L3 5V11C3 16 7 21 12 22C17 21 21 16 21 11V5L12 2Z" fill="#00A8FF"/></svg>
        </div>
        <div class="brand">
	<div class="brand">
  <div>
    <h1 class="scanner-title">RiskGuard</h1>
    <p class="scanner-slogan">Intelligent protection against digital risks</p>
  </div>
</div>
</div>
      </div>

      <div class="controls">
        <button class="btn" onclick="location.href='index.html'">Nova An√°lise </button>
		<button class="btn" onclick="location.href='dashboard.html'">‚Üê Voltar ao Dashboard</button>	


        <!-- üîµ BOT√ÉO ADICIONADO SEM ALTERAR NADA -->
      

        <div style="width:12px"></div>
      </div>
    </header>

    <main class="grid">

      <section class="left-col">

        <div class="card">
          <div class="scan-row">
            <select id="analysisType">
              <option value="url">URL</option>
              <option value="ip">IP</option>
              <option value="domain">Dom√≠nio</option>
              <option value="hash">Hash</option>
            </select>
            <input id="inputValue" type="text" placeholder="ex: replevysquab.top or https://..."/>
            <button id="btnAnalyze">üöÄ Iniciar An√°lise</button>
          </div>
        </div>

        <div class="card score-card">
          <div class="score-left">
            <canvas id="scoreChart" width="120" height="120"></canvas>
          </div>
          <div class="score-right">
            <div class="title">Resumo de Seguran√ßa</div>
            <div style="display:flex; align-items:center; gap:12px;">
              <div>
                <div id="riskScoreDisplay" class="score-value">‚Äî / 100</div>
                <div id="classification" class="classification-display low-risk">‚Äî</div>
              </div>
              <div style="margin-left:auto; text-align:right">
                <div style="font-size:12px; color:var(--muted)">√öltima an√°lise</div>
                <div id="lastAnalysis" style="font-size:12px; color:var(--muted)">‚Äî</div>
              </div>
            </div>
            <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
              <button id="btnModalDetails" class="btn secondary" disabled>Detalhes</button>
              <button id="btnReRun" class="btn secondary">Reanalisar</button>
            </div>
          </div>
        </div>

        <div class="card small">
          <div class="title">Ferramentas consultadas</div>
          <div class="tools-list" id="toolsList">
            <div class="tool-pill"><span class="dot ok"></span> VirusTotal</div>
            <div class="tool-pill"><span class="dot ok"></span> urlscan.io</div>
            <div class="tool-pill"><span class="dot empty"></span> Google WebRisk</div>
            <div class="tool-pill"><span class="dot empty"></span> AbuseIPDB</div>
            <div class="tool-pill"><span class="dot empty"></span> OTX</div>
            <div class="tool-pill"><span class="dot err"></span> Shodan</div>
          </div>
        </div>

        <div class="card">
          <div class="title">Retorno IA (Gemini) ü§ñ</div>
          <div id="aiAnalysis" style="min-height:64px;">Aguardando an√°lise...</div>
        </div>

        <div class="card">
          <div class="title">Resumo de Seguran√ßa (r√°pido)</div>
          <div id="securityAnalysis">‚Äî</div>
        </div>

        <div class="card">
          <div class="title">IOCs extra√≠dos</div>
          <div id="iocsSummary"><em>Nenhum</em></div>
        </div>

      </section>

      <aside class="right-col">

        <!-- ============================= -->
        <!--  3 CARDS VERTICAIS (TECHNICAL) -->
        <!-- ============================= -->

        <!-- Card A: Resumo t√©cnico (preserva id para app.js) -->
        <div id="technicalSummaryCard" class="card">
          <div class="title">Resumo t√©cnico</div>
          <!-- IMPORTANT: preserve this id exactly, app.js writes here -->
          <div id="technicalSummary" style="min-height:120px">Aguardando...</div>
        </div>

        <!-- Card B: Abuse / Geo summary (preserve ids) -->
        <div id="abuseCard" class="card">
          <div class="title">Abuse / Geo</div>
          <!-- app.js writes to #abuse -->
          <div id="abuse">‚Äî</div>
          <!-- app.js also uses #details for geo/details -->
          <div id="details" style="margin-top:10px">‚Äî</div>
        </div>

        <!-- Card C: (optional extra) DNS / outros  - kept as separate card for clarity -->
        <div id="geoCard" class="card">
          <div class="title">Infraestrutura</div>
          <!-- keep showing DNS / other info if app.js fills technicalSummary or details -->
          <div id="infraExtra" style="min-height:20px; color:var(--muted);">‚Äî</div>
        </div>

        <hr style="border:none; border-top:1px solid var(--border); margin:10px 0" />

        <!-- ============================= -->
        <!--   EVID√äNCIAS (RAW) CARD      -->
        <!--   preserve #evidence - app.js writes here -->
        <!-- ============================= -->
        <div class="card">
          <div class="title">Evid√™ncias (RAW)</div>

          <!-- app.js will fill #evidence (kept intact) -->
          <div id="evidence">
            <pre style="white-space:pre-wrap; color:#b6c8da">‚Äî</pre>
          </div>

          <!-- Toggle button (local behavior only) -->
          <button id="btnToggleRaw" class="btn secondary">Mostrar mais</button>
        </div>

        <div class="card small">
          <div class="title">Opera√ß√µes</div>
          <div style="display:flex; gap:8px">
            <button id="btnIgnore" class="btn secondary">Ignorar</button>
            <button id="btnWhitelist" class="btn secondary">Adicionar √† whitelist</button>
          </div>
        </div>

      </aside>
    </main>

    <footer>¬© SOC Scanner ‚Ä¢ Mostra todas as fontes consultadas ‚Ä¢ UI otimizada</footer>
  </div>

  <!-- MODAL ORIGINAL -->
  <div id="analysisModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <h3 style="margin:0">Detalhes da An√°lise</h3>
        <span style="cursor:pointer" onclick="document.getElementById('analysisModal').style.display='none'">&times;</span>
      </div>

      <div class="tabs" role="tablist" style="margin-top:12px">
        <div class="tab active" data-tab="ia">Resumo IA</div>
        <div class="tab" data-tab="raw">RAW JSON</div>
        <div class="tab" data-tab="payload">IA Payload</div>
      </div>

      <div id="modalBody" style="min-height:300px; margin-top:10px; color:#c8d8e8">
        <div data-panel="ia" class="panel">Carregando resumo IA...</div>
        <div data-panel="raw" class="panel" style="display:none"><pre id="modalRaw"></pre></div>
        <div data-panel="payload" class="panel" style="display:none"><pre id="modalPayload"></pre></div>
      </div>
    </div>
  </div>

  <!-- üîµ NOVO MODAL DE IMPRESS√ÉO (ADICIONADO) -->
  <div id="printSummaryModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content" style="max-width:700px;">
      <h3 style="margin-top:0">Resumo para Impress√£o</h3>

      <div id="printableSummary" style="margin-top:10px; color:#dbe6f3;">
      </div>

      <div style="display:flex; justify-content:flex-end; margin-top:20px; gap:10px;">
        <button id="btnPrint" class="btn">üñ®Ô∏è Imprimir</button>
        <button id="btnClosePrintModal" class="btn secondary">Fechar</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>

  <!-- SCRIPT DO MODAL DE IMPRESS√ÉO (mantido) -->
 <script>
  document.addEventListener("DOMContentLoaded", () => {

    const btnOpen = document.getElementById("btnOpenPrintModal");
    const btnClose = document.getElementById("btnClosePrintModal");
    const btnPrint = document.getElementById("btnPrint");

    const modal = document.getElementById("printSummaryModal");
    const printable = document.getElementById("printableSummary");

    const ai = document.getElementById("aiAnalysis");
    const summary = document.getElementById("securityAnalysis");
    const evidence = document.getElementById("evidence");
    const technical = document.getElementById("technicalSummary");

    btnOpen?.addEventListener("click", () => {
      printable.innerHTML = `
        <h3>Resumo IA</h3>
        ${ai?.innerHTML || ""}

        <h3 style="margin-top:20px">Resumo R√°pido</h3>
        ${summary?.innerHTML || ""}


        <h3 style="margin-top:20px">Resumo T√©cnico</h3>
        ${technical?.innerHTML || ""}
      `;

      modal.style.display = "flex";
    });

    btnClose?.addEventListener("click", () => modal.style.display = "none");

    window.addEventListener("click", (ev) => {
      if (ev.target === modal) modal.style.display = "none";
    });

    btnPrint?.addEventListener("click", () => window.print());

  });
</script>

  <!-- SCRIPT: Toggle RAW EXPAND/ COLLAPSE (isolado, n√£o altera app.js) -->
  <script>
    (function(){
      document.addEventListener('DOMContentLoaded', function(){
        const evidenceBox = document.getElementById('evidence');
        const btn = document.getElementById('btnToggleRaw');

        if (!evidenceBox || !btn) return;

        let expanded = false;
        btn.addEventListener('click', function(){
          const pre = evidenceBox.querySelector('pre');
          if (!pre) return;
          expanded = !expanded;
          if (expanded) {
            pre.style.maxHeight = '800px';
            pre.style.overflow = 'auto';
            btn.textContent = 'Mostrar menos';
          } else {
            pre.style.maxHeight = '120px';
            pre.style.overflow = 'hidden';
            btn.textContent = 'Mostrar mais';
            // scroll to top of pre to avoid awkward viewport
            pre.scrollTop = 0;
          }
        });
      });

      // existing tab handlers (kept exactly)
      document.addEventListener('click', function(ev){
        const t = ev.target;
        if (t && t.classList && t.classList.contains('tab')) {
          document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
          t.classList.add('active');
          const tab = t.getAttribute('data-tab');
          document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
          const panel = document.querySelector('[data-panel="'+tab+'"]');
          if (panel) panel.style.display = 'block';
        }
      });

      document.getElementById('btnModalDetails')?.addEventListener('click', ()=> {
        document.getElementById('analysisModal').style.display = 'flex';
      });
    })();
  </script>


<div id="loadingOverlay">
  <div class="loader"></div>
  <div class="loading-title">Analisando‚Ä¶</div>
  <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
  <div class="loading-steps" id="loadingStep">Iniciando‚Ä¶</div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const overlay = document.getElementById("loadingOverlay");
  const btn = document.getElementById("btnAnalyze");
  const progressBar = document.getElementById("progressBar");
  const stepText = document.getElementById("loadingStep");

  const steps = [
    "Consultando DNS‚Ä¶","Analisando VirusTotal‚Ä¶","Checando UrlScan‚Ä¶",
    "Verificando Google WebRisk‚Ä¶","Validando AbuseIPDB‚Ä¶",
    "Consultando OTX‚Ä¶","Obtendo dados GeoIP‚Ä¶","Gerando an√°lise via IA‚Ä¶"
  ];

  let idx = 0, progress = 0, interval = null;

  function start() {
    overlay.style.display = "flex";
    progress = 0;
    idx = 0;

    interval = setInterval(() => {
      progress = Math.min(progress + 7, 95);
      progressBar.style.width = progress + "%";
      stepText.textContent = steps[idx];
      idx = (idx + 1) % steps.length;
    }, 1200);
  }

  function stop() {
    clearInterval(interval);
    progressBar.style.width = "100%";
    stepText.textContent = "Finalizando‚Ä¶";
    setTimeout(() => overlay.style.display = "none", 350);
  }

  // Inicia o overlay no clique
  btn?.addEventListener("click", () => {
    start();
  });

  // Encerra SOMENTE quando app.js disser que terminou
  document.addEventListener("analysisComplete", () => {
    stop();
  });
});

</script>

<!-- üîµ MOBILE GLASS NAVIGATION -->
<div class="mobile-nav-glass">
  <button onclick="location.href='dashboard.html'">üè†</button>
  <button onclick="location.href='history.html'">üïë</button>
  <button onclick="location.href='plans.html'">üì¶</button>
  <button onclick="location.href='profile.html'">üë§</button>
  <button onclick="location.href='/auth/logout'">üö™</button>
</div>

</body>
</html>
